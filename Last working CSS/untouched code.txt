


<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Upload Documents</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        table { border-collapse: collapse; width: 600px; }
        th, td { border: 1px solid #ccc; padding: 10px; }
        .ok { color: #0a7a0a; }
        .err { color: #b11515; }
        #results { margin-top: 12px; font-family: ui-sans-serif, system-ui, Arial; }
    </style>
</head>
<body>

<table id="docTable">
    <thead>
        <tr>
            <th>#</th>
            <th>Document Name</th>
            <th>Attachment</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<button id="uploadAllBtn" style="margin-top: 12px;">Upload All</button>
<div id="results"></div>

<script>
    // Your list-driven rows
    const items = ["ID", "Driving License", "Birth Certificate"];
    const tbody = document.querySelector("#docTable tbody");

    items.forEach((item, index) => {
        const row = `
            <tr>
                <td>${index + 1}</td>
                <td>${item}</td>
                <td>
                    <div style="padding-top: 6px;">
                        <input 
                            type="file" 
                            id="file_upload_${index + 1}" 
                            data-doc="${item}"
                            style="margin-top: 6px; display: inline-block; padding: 6px;"
                        />
                    </div>
                </td>
            </tr>
        `;
        tbody.insertAdjacentHTML("beforeend", row);
    });

    // ---- Upload All Logic ----
    async function uploadDocument() {
        const resultsEl = $("#results").empty();
        const fileInputs = Array.from(document.querySelectorAll("input[type='file'][id^='file_upload_']"));

        // Collect selections
        const selections = fileInputs
            .filter(input => input.files && input.files.length > 0)
            .map(input => ({
                inputId: input.id,
                docName: input.getAttribute("data-doc"),
                file: input.files[0]
            }));

        if (selections.length === 0) {
            alert("Please choose at least one file to upload.");
            return;
        }

        // Helper: upload one file (wrap jQuery ajax in a Promise)
        const uploadOne = ({ docName, file }) => {
            const filename = file.name;
            const form = new FormData();
            // MUST match Power Automate trigger parameter names
            form.append("file", file);
            form.append("filename", filename);
            // (optional) include the document type
            form.append("documentType", docName);

            const url = "https://5735f8ecc25ce1c99959712e4327b8.d8.environment.api.powerplatform.com/powerautomate/automations/direct/workflows/b2c6e9b6f0b2423caf45fe95e40bd9af/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=uX3qpJWApwDTD302HVQSua88ZJq_TFgO3OpWsoVAjVg";

            return new Promise((resolve) => {
                $.ajax({
                    type: "POST",
                    url,
                    processData: false,
                    contentType: false,
                    data: form,
                    success: function (result) {
                        // Treat exactly "Uploaded" as success (your current convention)
                        if (result === "Uploaded") {
                            resolve({ ok: true, docName, filename });
                        } else {
                            resolve({ ok: false, docName, filename, error: "Unexpected response: " + String(result) });
                        }
                    },
                    error: function (xhr, status, error) {
                        resolve({ ok: false, docName, filename, error: `${status}: ${error}` });
                    }
                });
            });
        };

        // Upload all in parallel
        const promises = selections.map(sel => uploadOne(sel));
        const results = await Promise.all(promises);

        // Aggregate
        const successes = results.filter(r => r.ok);
        const failures = results.filter(r => !r.ok);

        if (failures.length === 0) {
            resultsEl
                .append(`<div class="ok"><strong>All ${successes.length} file(s) uploaded successfully.</strong></div>`)
                .append(`<ul class="ok">${successes.map(s => `<li>${s.docName} — ${s.filename}</li>`).join("")}</ul>`);
        } else {
            // Show both: what worked and what didn’t
            if (successes.length > 0) {
                resultsEl
                    .append(`<div class="ok"><strong>${successes.length} file(s) uploaded successfully:</strong></div>`)
                    .append(`<ul class="ok">${successes.map(s => `<li>${s.docName} — ${s.filename}</li>`).join("")}</ul>`);
            }
            resultsEl
                .append(`<div class="err"><strong>${failures.length} file(s) failed to upload:</strong></div>`)
                .append(`<ul class="err">${failures.map(f => `<li>${f.docName} — ${f.filename} → ${f.error}</li>`).join("")}</ul>`);
        }
    }

    // Hook button
    document.getElementById("uploadAllBtn").addEventListener("click", uploadDocument);
</script>

</body>
</html>






<!--




<div class="row sectionBlockLayout text-start" style="display: flex; flex-wrap: wrap; margin: 0px; min-height: auto; padding: 8px;">
  <div class="container" style="display: flex; flex-wrap: wrap;">
    <div class="col-lg-12 columnBlockLayout" style="flex-grow: 1; display: flex; flex-direction: column; min-width: 250px; padding: 16px; margin: 60px 0px;">
   
      

      <h6 id="uploadsuccess" style="color: green;"></h6>
  
      <h3 style="color: black;"><b>Upload document to SharePoint Document Library</b></h3>

    
      <div style="padding-top: 30px;"><input type="file" id="file_upload" style="margin-top: 10px; display: inline-block; padding: 8px;" /></div>

     <button onclick="uploadDocument()" class="btn-primary" style="margin-top: 30px;">Upload File</button>
    </div>
  </div>
</div>

-->